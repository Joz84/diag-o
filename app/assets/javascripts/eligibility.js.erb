var map;
var geocoder; //Added on 27/09/2016
var marker;
var bounds;
window.onload = initMap;
function initMap() {
  map = new google.maps.Map(document.getElementById('map'), {
    center: center,
    zoom: 14,
    scaleControl: true
  });
  geocoder = new google.maps.Geocoder(); //Added on 27/09/2016
  bounds = new google.maps.LatLngBounds();
  google.maps.event.addListenerOnce(map, 'tilesloaded', function(evt) {
    bounds = map.getBounds();
  });
    marker = new google.maps.Marker({
      position: center
    });

ctaLayer = new google.maps.KmlLayer({
    url: 'http://res.cloudinary.com/zanzibar/raw/upload/v1504776893/floirac_test_fbetds.kml',
    map: map
  });

var zone1 = document.getElementById('zone1');
console.log(zone1.dataset.area)

polygon1 = new google.maps.Polygon({
    path: areaOrange,
    geodesic: true,
    strokeColor: '#FFd000',
    strokeOpacity: 1.0,
    strokeWeight: 4,
    fillColor: '#FFA500',
    fillOpacity: 0.35
  });

polygon2 = new google.maps.Polygon({
    path: areaRouge,
    geodesic: true,
    strokeColor: '#FF0000',
    strokeOpacity: 1.0,
    strokeWeight: 4,
    fillColor: '#FF0000',
    fillOpacity: 0.35
  });



  polygon1.setMap(map);
  polygon2.setMap(map);

  var input = /** @type {!HTMLInputElement} */(
    document.getElementById('pac-input'));
        var types = document.getElementById('type-selector');
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(input);
        map.controls[google.maps.ControlPosition.TOP_LEFT].push(types);

        var autocomplete = new google.maps.places.Autocomplete(input);
        autocomplete.addListener('place_changed', function() {
    marker.setMap(null);
    var place = autocomplete.getPlace();
    var newBounds = new google.maps.LatLngBounds(bounds.getSouthWest(), bounds.getNorthEast()); //Changed
    // removed newBounds = bounds;
          if (!place.geometry) {
            geocodeAddress(input.value);//Added on 27/09/2016
            //window.alert("Autocomplete's returned place contains no geometry");
            return;
          };
      marker.setPosition(place.geometry.location);
      marker.setMap(map);
      newBounds.extend(place.geometry.location);
      map.fitBounds(newBounds);
      if (google.maps.geometry.poly.containsLocation(place.geometry.location, polygon1)){
      alert('Votre addresse est en zone ' + zone1.dataset.color);
      console.log(polygon2.poly.path)
      } else if (google.maps.geometry.poly.containsLocation(place.geometry.location, polygon2)) {
      alert('Votre addresse est en zone rouge!');
      } else {
      alert('The address is outside of the area.');
      };
     });
}

var center = new google.maps.LatLng(44.8035,-0.5731);


var areaOrange = [
 { lat: 44.80359712236584, lng: -0.51317632796123 },
 { lat: 44.80343112410052,  lng:-0.517242017073627 },
 { lat: 44.803432239850856, lng:-0.517244698569879 },
 { lat: 44.803432923191316,  lng:-0.517242247997421 },
 { lat: 44.7917,  lng:-0.5161 },
 { lat: 44.7928,  lng:-0.5007 },
];

var areaRouge = [
Â { lat: 44.803432239850856,  lng:-0.517244698569879 },
 { lat: 44.8037598039599,  lng:-0.518031948635293 },
 { lat: 44.80407656918752,  lng:-0.518062968918885 },
 { lat: 44.8146,  lng:-0.5278 },
 { lat: 44.8183,  lng:-0.5096 },
 { lat: 44.8114,  lng:-0.4700 },

];
